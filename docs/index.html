
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Alpaca Paper Dashboard</title>
<style>
  :root {
    --bg: #0b0d10; --card: #111418; --muted: #9aa4ad; --fg: #e6eef5; --border: #222831;
    --pos: #14b86e; --neg: #ff5a5f; --accent: #60a5fa;
  }
  @media (prefers-color-scheme: light) {
    :root {
      --bg:#f7f8fa; --card:#ffffff; --muted:#5b6670; --fg:#0b141a; --border:#dfe5ec;
      --pos:#0a7f4f; --neg:#c03a3e; --accent:#2563eb;
    }
  }
  * { box-sizing: border-box; }
  body {
    margin:0; background:var(--bg); color:var(--fg);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    padding:16px;
  }
  .container{max-width:1200px;margin:0 auto}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;flex-wrap:wrap}
  h1{font-size:20px;margin:0}
  .muted{color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
  @media (max-width:900px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media (max-width:560px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}
  .kpi .label{font-size:12px;color:var(--muted);margin-bottom:6px}
  .kpi .value{font-size:22px;font-weight:600}
  .section-title{font-size:16px;margin:14px 0 6px 0}
  .tablewrap{overflow:auto;border:1px solid var(--border);border-radius:12px}
  table{border-collapse:separate;border-spacing:0;width:100%;min-width:680px;background:var(--card)}
  th,td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:14px;text-align:right;white-space:nowrap}
  th:first-child,td:first-child{text-align:left}
  thead th{position:sticky;top:0;background:var(--card);z-index:1}
  tbody tr:hover{background:rgba(96,165,250,.08)}
  .pos{color:var(--pos)} .neg{color:var(--neg)}
  .row{display:grid;grid-template-columns:2fr 1fr;gap:12px}
  @media (max-width:900px){.row{grid-template-columns:1fr}}
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  select,button{padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--fg)}
  .foot{margin-top:12px;color:var(--muted);font-size:12px}
  .chartbox{height:320px}
  @media (max-width:560px){.chartbox{height:260px}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>Alpaca Paper Dashboard</h1>
      <div class="muted">Last update: 2025-09-27T22:42:31Z (UTC)</div>
    </div>
    <div class="toolbar">
      <label class="muted" for="symSel">Symbol</label>
      <select id="symSel"></select>
      <button id="toggleMetric">Metric: % P/L</button>
    </div>
  </header>

  <div class="grid">
    <div class="card kpi"><div class="label">Portfolio Value</div><div class="value">$100,127.30</div></div>
    <div class="card kpi"><div class="label">Last Equity (prev close)</div><div class="value">$100,127.30</div></div>
    <div class="card kpi"><div class="label">Cash</div><div class="value">$5.01</div></div>
    <div class="card kpi"><div class="label">Buying Power</div><div class="value">$100,132.31</div></div>
  </div>

  <div class="row">
    <div class="card">
      <div class="section-title">Equity History</div>
      <div class="chartbox"><canvas id="equityChart"></canvas></div>
    </div>
    <div class="card">
      <div class="section-title">Per-Symbol Performance</div>
      <div class="muted" style="font-size:13px;margin-bottom:6px">Switch between % P/L and Price</div>
      <div class="chartbox"><canvas id="symbolChart"></canvas></div>
    </div>
  </div>

  <div class="section-title">Positions</div>
  <div class="tablewrap">
    <table>
      <thead>
        <tr><th>Symbol</th><th>Qty</th><th>Avg Entry</th><th>Current</th><th>Market Value</th><th>Unreal P/L</th><th>Unreal P/L %</th></tr>
      </thead>
      <tbody>
        <tr><td>ANIP</td><td>262.988</td><td>$95.05</td><td>$93.05</td><td>$24,471.01</td><td class='neg'>$-525.98</td><td class='neg'>-2.10%</td></tr><tr><td>APH</td><td>203.021</td><td>$123.13</td><td>$122.60</td><td>$24,890.39</td><td class='neg'>$-107.60</td><td class='neg'>-0.43%</td></tr><tr><td>CENX</td><td>958.956</td><td>$26.07</td><td>$27.99</td><td>$26,841.16</td><td class='pos'>$1,841.19</td><td class='pos'>7.36%</td></tr><tr><td>EAT</td><td>180.95</td><td>$138.16</td><td>$132.19</td><td>$23,919.72</td><td class='neg'>$-1,080.27</td><td class='neg'>-4.32%</td></tr>
      </tbody>
    </table>
  </div>

  <div class="section-title">Open Orders</div>
  <div class="tablewrap">
    <table>
      <thead>
        <tr><th>ID</th><th>Symbol</th><th>Side</th><th>Type</th><th>Qty</th><th>Status</th><th>Submitted</th></tr>
      </thead>
      <tbody>
        <tr><td class='muted'>a6c3ce6f-37c0-4519-ab86-edbd74185cdc</td><td>EAT</td><td>sell</td><td>stop</td><td>180.949551244</td><td>accepted</td><td>2025-09-27T22:17:35.964512+00:00</td></tr><tr><td class='muted'>f2e8829b-c685-4398-923b-4db2721d26e1</td><td>CENX</td><td>sell</td><td>stop</td><td>958.955504411</td><td>accepted</td><td>2025-09-26T20:19:22.283694+00:00</td></tr><tr><td class='muted'>d6645009-f7a7-42b1-89be-14917ef1754d</td><td>APH</td><td>sell</td><td>stop</td><td>203.021115893</td><td>accepted</td><td>2025-09-26T20:19:22.255592+00:00</td></tr><tr><td class='muted'>f8cd35dd-808f-4736-8d25-c5731b8ab784</td><td>ANIP</td><td>sell</td><td>stop</td><td>262.987795896</td><td>accepted</td><td>2025-09-26T20:19:22.224344+00:00</td></tr>
      </tbody>
    </table>
  </div>

  <div class="foot">Data: Alpaca Paper API · Static page updated by GitHub Actions · Mobile-friendly.</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const equityLabels = ["2025-09-27T22:25:04Z", "2025-09-27T22:42:31Z"];
const equityValues = [100127.3, 100127.3];
const symbolHistory = {"ANIP": {"t": ["2025-09-27T22:42:31Z"], "price": [93.05], "plpc": [-2.1042]}, "APH": {"t": ["2025-09-27T22:42:31Z"], "price": [122.6], "plpc": [-0.43039999999999995]}, "CENX": {"t": ["2025-09-27T22:42:31Z"], "price": [27.99], "plpc": [7.364800000000001]}, "EAT": {"t": ["2025-09-27T22:42:31Z"], "price": [132.19], "plpc": [-4.3210999999999995]}};

const eqCtx = document.getElementById('equityChart').getContext('2d');
const eqChart = new Chart(eqCtx, {
  type: 'line',
  data: {
    labels: equityLabels,
    datasets: [{ label:'Portfolio Value', data: equityValues, borderWidth:2, fill:false, tension:0.25 }]
  },
  options: {
    responsive:true,
    maintainAspectRatio:false,
    plugins:{ legend:{display:false} },
    scales:{
      y:{ ticks:{ callback:(v)=>'$'+v.toLocaleString() } }
    }
  }
});

// --- Per-symbol chart ---
const symSel = document.getElementById('symSel');
const toggleBtn = document.getElementById('toggleMetric');
let metric = 'plpc'; // 'plpc' (%) o 'price'

const symbols = Object.keys(symbolHistory).sort();
for (const s of symbols) {
  const opt = document.createElement('option');
  opt.value = s; opt.textContent = s;
  symSel.appendChild(opt);
}
if (symbols.length === 0) {
  const opt = document.createElement('option');
  opt.value = ''; opt.textContent = 'No positions';
  symSel.appendChild(opt);
}

const symCtx = document.getElementById('symbolChart').getContext('2d');
let symChart = null;

function renderSymbolChart(sym) {
  if (!sym || !symbolHistory[sym]) return;
  const H = symbolHistory[sym];
  const labels = H.t;
  const data = (metric === 'plpc') ? H.plpc : H.price;
  const label = (metric === 'plpc') ? '% P/L' : 'Price';
  if (symChart) symChart.destroy();
  symChart = new Chart(symCtx, {
    type: 'line',
    data: {
      labels,
      datasets: [{ label: sym + ' ' + label, data, borderWidth:2, fill:false, tension:0.25 }]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      plugins:{ legend:{display:false} },
      scales:{
        y:{
          ticks:{
            callback:(v)=> metric==='plpc' ? v.toFixed(2)+'%' : '$'+v.toLocaleString()
          }
        }
      }
    }
  });
}

symSel.addEventListener('change', ()=> renderSymbolChart(symSel.value));
toggleBtn.addEventListener('click', ()=>{
  metric = (metric === 'plpc') ? 'price' : 'plpc';
  toggleBtn.textContent = 'Metric: ' + (metric === 'plpc' ? '% P/L' : 'Price');
  renderSymbolChart(symSel.value);
});

if (symbols.length > 0) {
  symSel.value = symbols[0];
  renderSymbolChart(symbols[0]);
}
</script>
</body>
</html>
